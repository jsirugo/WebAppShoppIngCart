@page
@model IndexModel
@inject WebsiteApp.Data.AccessControl accessControl

@{
    ViewData["Title"] = "Home page";
}

<h1>Welcome, @accessControl.LoggedInAccountName!</h1>

<ul>
    @if (Model.AllProducts != null)
    {
        <form method="get" asp-page="/Index">
            <input type="text" name="searchTerm" value="@Model.SearchTerm" placeholder="Search">
            <select name="category">
                <option value="">All Categories</option>
                @foreach (var category in Model.AllProducts.Select(p => p.Category).Distinct())
                {
                    <option value="@category">@category</option>
                }
            </select>
            <button type="submit">Filter</button>
        </form>
    }

    @if (Model.Products != null)
    {
        @foreach (var product in Model.Products)
        {
            <li>
                <a asp-page="./ProductDetails" asp-route-id="@product.ID">
                    @product.Name - @product.Price sek
                </a>
            </li>
            <li>
                <a asp-page="./ProductDetails" asp-route-id="@product.ID">
                    <img src="images/@product.ImagePath" style="width: 200px" />
                </a>
            </li>
            <li>
                <form method="post" asp-page-handler="AddItemToCart">
                    <input type="hidden" name="searchTerm" value="@Model.SearchTerm" />
                    <input type="hidden" name="category" value="@Model.Category" />
                    <input type="hidden" name="page" value="@Model.PageNumber" />
                    <input type="hidden" name="ProductId" value="@product.ID" />
                    <button type="submit">Add to cart</button>
                </form>
            </li>
        }

    }
    else
    {
        <p>No products found.</p>
    }
    <ul class="pagination">
        @if (Model.ShowPreviousButton)
        {
            <li>
                <form method="get" asp-page="/Index">
                    <input type="hidden" name="searchTerm" value="@Model.SearchTerm" />
                    <input type="hidden" name="category" value="@Model.Category" />
                    <button type="submit" class="nav-btn" name="currentPage" value="@(Model.PageNumber - 1)">Previous</button>
                </form>
            </li>
        }

        @if (Model.ShowNextButton)
        {
            <li>
                <form method="get" asp-page="/Index">
                    <input type="hidden" name="searchTerm" value="@Model.SearchTerm" />
                    <input type="hidden" name="category" value="@Model.Category" />
                    <button type="submit" class="nav-btn" name="currentPage" value="@(Model.PageNumber + 1)">Next</button>
                </form>
            </li>
        }

         @*  @foreach (var pageNumber in Model.pageNumbers)
        {
            <li class="pagelinks">
                <a asp-page="/Index"
                   asp-route-currentPage="@pageNumber"
                   asp-route-searchTerm="@Model.SearchTerm"
                   asp-route-category="@Model.Category">
                    Page: @pageNumber
                </a>
            </li> 
        }  *@
    </ul>
</ul>

